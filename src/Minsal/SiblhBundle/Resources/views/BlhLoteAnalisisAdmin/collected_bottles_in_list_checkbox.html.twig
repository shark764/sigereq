{#

This file is part of the Sonata package.

(c) Thomas Rabaix <thomas.rabaix@sonata-project.org>

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}

<div class="alert alert-dark-success-lighter-medicine alert-dismissible help-alert-radiology-result-status no-diagnosis-request" role="alert">
    <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only"> Cerrar </span></button>
    <span>
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>&nbsp; <span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span>&nbsp; Si el lote no puede crearse por deficit, consulte frascos para análisis en el menú <a class="btn-link btn-link-primary-v4" href="{{ path('siblh_donacion_create') }}">Consultar donaciones</a>.
    </span>
</div>

<table data-toggle="table" class="table table-condensed table-hover table-xray-supreme-head" id="blh_collected_bottle_target_bstable" name="blh_collected_bottle_target_bstable">
    <thead>
        <tr>
            <th>Origen</th>
            <th>Paciente</th>
            <th>Reg.</th>
            <th>Procedencia</th>
            <th>Servicio</th>
            <th>Modalidad</th>
            <th>Procedimiento</th>
            <th>Téc. / Lic. / Rdlg.</th>
            <th>Fecha (Est)</th>
            <th>Descargar</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for i in 0..10 %}
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><input type="checkbox" name=""></td>
            </tr>
        {% endfor %}

        {% for child in form %}
        	{% set s = choices[child.vars.value].data %}
            {% set form_widget_content %}
                {{ form_widget(child, {'horizontal': true, 'horizontal_input_wrapper_class': ''}) }} {# {'horizontal': true, 'horizontal_input_wrapper_class': ''} needed to avoid MopaBootstrapBundle messing with the DOM #}
            {% endset %}
            <tr>
                <td>{{ s.getIdProcedimientoRealizado().getIdSolicitudEstudio().getIdEstablecimientoOrigen() }}</td>
                <td>{% if s.getIdExpedienteReferido() is not null %}<span class="text-dark-emergency">{{ s.getIdExpedienteReferido().getIdReferido() }}</span>{% else %}{{ s.getIdExpediente().getIdPaciente() }}{% endif %}</td>
                <td>{% if s.getIdExpedienteReferido() is not null %}<span class="text-dark-emergency">{{ s.getIdExpedienteReferido().getNumero() }}</span>{% else %}{{ s.getIdExpediente().getNumero() }}{% endif %}</td>
                <td>{{ s.getIdProcedimientoRealizado().getIdSolicitudEstudio().getIdAtenAreaModEstab().getIdAreaModEstab() }}</td>
                <td>{{ s.getIdProcedimientoRealizado().getIdSolicitudEstudio().getIdAtenAreaModEstab() }}</td>
                <td>{{ s.getIdProcedimientoRealizado().getIdSolicitudEstudio().getIdAreaServicioDiagnostico() }}</td>
                <td>
                    <ul class="bs-list-styled">
                        {% for p in s.getIdProcedimientoRealizado().getIdSolicitudEstudio().getSolicitudEstudioProyeccion() %}
                            <li>{{ p }}</li>
                        {% endfor %}
                    </ul>
                </td>
                <td>{{ s.getIdProcedimientoRealizado().getIdTecnologoRealiza() }}</td>
                <td>{{ s.getFechaHoraReg()|format_date('EEEE, MMMM d, yyyy', 'es_ES') ~ ' ' ~ s.getFechaHoraReg|date('H:i:s A') }}</td>
                <td>
                    <div class="btn-toolbar" role="toolbar" aria-label="...">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-xray-awesome-blue btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Visualizar estudio">
                                <i class="glyphicon glyphicon-eye-open"></i>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" style="right: 0; left: auto;" >
                                <li>
                                    <a href="http://127.0.0.1:8080/weasis-pacs-connector/viewer.jnlp?studyUID={{ s.getEstudioUid()|trim }}" target="_blank" title="Descargar estudio">
                                        <i class="glyphicon glyphicon-save"></i> Weasis
                                    </a>
                                </li>
                                <li>
                                    <a href="http://127.0.0.1:8080/oviyam2/viewer.html?patientID={{ s.getIdExpediente().getNumero()|trim }}&studyUID={{ s.getEstudioUid()|trim }}" target="_blank" title="Visualizar estudio en web">
                                        <i class="glyphicon glyphicon-play-circle"></i> Oviyam2
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
                <td style="vertical-align: middle; text-align: center;">{{ form_widget_content|raw }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script type="text/javascript">

    jQuery(document).ready(function() {
        //////////////////////////////////////////////////////////////////////////////////////////////
        //////// collected bottles table
        //////////////////////////////////////////////////////////////////////////////////////////////
        {#var $table = jQuery('#blh_collected_bottle_target_bstable');
        $table.bootstrapTable('destroy').bootstrapTable();#}

        {% if choices|length == 0 %}
            swal({
                html:true,
                title: "La consulta no devolvió ningún registro",
                text: "Consulte frascos para análisis en el menú <a class=\"btn-link btn-link-primary-v4\" href=\"{{ path('siblh_donacion_create') }}\">Consultar donaciones</a>",
                type: "warning",
                showCancelButton: true,
                cancelButtonClass: "btn-sm btn-default",
                confirmButtonClass: "btn-sm btn-primary-v4",
                confirmButtonText: "Aceptar",
                cancelButtonText: "Cancelar",
                // closeOnConfirm: false,
                // closeOnCancel: false,
                animation: false,
            },
            function(isConfirm) {
                if (isConfirm) {
                    var url = Routing.generate('siblh_donacion_create', {mode: 'standard', interaction: false});
                    window.location.href = url; // simulate link click
                }
            });
        {% endif %}
        //////////////////////////////////////////////////////////////////////////////////////////////

        window.alert('bootstrapTable requiere TH en thead');
    });

</script>